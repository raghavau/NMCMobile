<!DOCTYPE html>
<html>

<head>
    <title>Index Page</title>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="semantic/css/semantic.css">
    <link rel="stylesheet" type="text/css" href="fontawesome4.7.0/css/font-awesome.css">
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="semantic/js/semantic.js"></script>
    <style type="text/css">
        body {
            background-color: #e5e5e5;
            overflow: hidden;
        }

        body>.grid {
            height: 100%;
        }

        .column {
            max-width: 450px;
        }

        #show {
            display: none;
        }

        #generate {
            opacity: 0;
            /*transform: translateX(0) rotate(0deg);
            transition: all .75s linear;*/
        }

        #generate.show2 {
            /*transform: translateX(0px) rotate(360deg);*/
            opacity: 1;
        }

    </style>
</head>

<body>
    <div class="ui middle aligned center aligned grid">
        <!-- ui raised very padded text container
             ui middle aligned center aligned grid
        -->
        <div class="ui column grid">
            <div class="column">
                <div class="ui stacked left aligned segment" id="reset">
                    <!-- red -->
                    <div class="ui red ribbon label">Reset Your PIN</div><br><br>
                    <form class="ui form">
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="user circle icon"></i>
                                <input id="empid" placeholder="Employee Id" type="text">
                            </div>
                        </div>
                        <button class="ui teal fluid submit button right labeled icon disabled" type="button" id="send">
                            <i class="right arrow icon"></i>
                            <span>Send OTP</span>
                        </button>
                        <div id="show">
                            <div class="ui blue tiny message">OTP sent to this Mobile No.</div>
                            <div class="field">
                                <div class="ui disabled left icon input">
                                    <i class="call square icon"></i>
                                    <input id="mobile" placeholder="Mobile No" type="text" readonly>
                                </div>
                            </div>
                            <div class="field">
                                <div class="ui left icon input">
                                    <i class="unlock alternate icon"></i>
                                    <input id="otp" placeholder="OTP" type="text">
                                </div>
                            </div>
                            <button class="ui green fluid submit button right labeled icon" type="button" id="verify">
                                <i class="checkmark icon"></i>
                                <span>Verify OTP</span>
                            </button>
                        </div>
                        <div class="ui error message"></div>
                    </form>
                </div>

                <div class="ui stacked left aligned segment" id="generate">
                    <!-- red -->
                    <div class="ui red ribbon label">Create New PIN</div><br><br>
                    <form class="ui form">
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="user circle icon"></i>
                                <input id="pin" placeholder="Enter PIN" type="text">
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="call square icon"></i>
                                <input id="cnfpin" placeholder="Confirm PIN" type="text">
                            </div>
                        </div>
                        <button class="ui green fluid submit button right labeled icon" type="button" id="confirm">
                            <i class="checkmark icon"></i>
                            <span>Confirm</span>
                        </button>
                        <div class="ui error message"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="hempid" />
</body>

</html>
<script type="text/javascript">
    var apiURL = 'http://175.101.102.104/NtraktApi/api/';
    var qsParm = new Array();

    function qs() {
        //debugger;
        var query = window.location.search.substring(1);
        var parms = query.split('&');
        for (var i = 0; i < parms.length; i++) {
            var pos = parms[i].indexOf('=');
            if (pos > 0) {
                var key = parms[i].substring(0, pos);
                var val = parms[i].substring(pos + 1);
                qsParm[key] = val;
            }
        }
        if (parms.length > 0) {
            $("#hempid").val(atob(qsParm["empid"]));
            return true;
        } else {
            window.location.href = 'index.html';
            return false;
        }
    }
    $(document).ready(function() {
        //debugger;
        qs();
        //$('#show').hide();
        //$('#generate').hide();
        var empid = $("#hempid").val();

        $("#empid").keyup(function() {
            //debugger;
            if ($(this)[0].value.trim().length > 0) {
                $("#send").removeClass('disabled');
            } else {
                $("#send").addClass('disabled');
            }
        });

        if (empid.trim().length > 0) {
            $.get(apiURL + 'User/Info/' + $("#hempid").val(), function(response) {
                //debugger;
                $("#empid").val(response.data[0].BioEmpNo);
                $("#mobile").val(response.data[0].MobileNo);
            }).done(function() {
                //debugger;
                $('#send').hide();
                $('#show').show();
                $('#otp').focus();
            });
        }
        $('#send').click(function() {
            empid = $('#empid').val();
            if (empid.trim().length > 0) {
                $.get(apiURL + 'User/Info/' + empid, function(response) {
                    //debugger;
                    $("#empid").val(response.data[0].BioEmpNo);
                    $("#mobile").val(response.data[0].MobileNo);
                }).done(function() {
                    //debugger;
                    $('#send').hide();
                    $('#show').show();
                    $('#otp').focus();
                });
            }
        });

        $('#verify').click(function() {
            $('#generate').show();
            $('#generate').toggleClass('show2');
            $('#reset').hide();
        });
    });

</script>
